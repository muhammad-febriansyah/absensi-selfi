<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dokumentasi Aplikasi E-Absensi</title>
    <style>
        @page {
            size: A4;
            margin: 4cm 3cm 3cm 4cm;
        }

        body {
            font-family: 'Times New Roman', Times, serif;
            line-height: 1.5;
            color: #000;
            max-width: 21cm;
            margin: 0 auto;
            padding: 20px;
            background: white;
            font-size: 12pt;
            text-align: justify;
        }

        h1 {
            font-size: 14pt;
            font-weight: bold;
            margin-top: 0;
            margin-bottom: 12pt;
            text-align: center;
            text-transform: uppercase;
            page-break-after: avoid;
        }

        h1.title {
            font-size: 16pt;
            margin-bottom: 6pt;
        }

        h2 {
            font-size: 12pt;
            font-weight: bold;
            margin-top: 12pt;
            margin-bottom: 12pt;
            page-break-after: avoid;
        }

        h3 {
            font-size: 12pt;
            font-weight: bold;
            margin-top: 12pt;
            margin-bottom: 12pt;
            font-style: italic;
            page-break-after: avoid;
        }

        h4 {
            font-size: 12pt;
            font-weight: bold;
            margin-top: 12pt;
            margin-bottom: 12pt;
            page-break-after: avoid;
        }

        p {
            text-align: justify;
            margin: 0;
            margin-bottom: 12pt;
            text-indent: 1.27cm;
        }

        p.no-indent {
            text-indent: 0;
        }

        .center {
            text-align: center;
            text-indent: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 12pt 0;
            page-break-inside: avoid;
        }

        th, td {
            border: 1px solid #000;
            padding: 6pt;
            text-align: left;
            vertical-align: top;
            font-size: 11pt;
        }

        th {
            background-color: #f0f0f0;
            font-weight: bold;
            text-align: center;
        }

        .table-title {
            font-weight: bold;
            margin-top: 12pt;
            margin-bottom: 6pt;
            text-indent: 0;
            text-align: center;
        }

        code {
            font-family: 'Courier New', Courier, monospace;
            background: #f5f5f5;
            padding: 2px 4px;
            border: 1px solid #ddd;
            font-size: 10pt;
        }

        pre {
            font-family: 'Courier New', Courier, monospace;
            background: #f5f5f5;
            border: 1px solid #000;
            padding: 12pt;
            overflow-x: auto;
            margin: 12pt 0;
            font-size: 9pt;
            line-height: 1.3;
            page-break-inside: avoid;
            text-align: left;
        }

        .code-title {
            font-weight: bold;
            margin-top: 12pt;
            margin-bottom: 6pt;
            text-indent: 0;
            text-align: center;
        }

        ul, ol {
            margin: 0;
            margin-bottom: 12pt;
            padding-left: 1.27cm;
        }

        li {
            margin: 6pt 0;
            text-align: justify;
        }

        .page-break {
            page-break-before: always;
        }

        .note {
            border: 1px solid #000;
            padding: 12pt;
            margin: 12pt 0;
            background: #f9f9f9;
        }

        .note p {
            text-indent: 0;
            margin-bottom: 6pt;
        }

        .note strong {
            display: block;
            margin-bottom: 6pt;
        }

        em {
            font-style: italic;
        }

        strong {
            font-weight: bold;
        }

        @media print {
            body {
                background: white;
            }
        }
    </style>
</head>
<body>

    <h1 class="title">DOKUMENTASI APLIKASI E-ABSENSI</h1>
    <p class="center" style="font-style: italic; margin-bottom: 24pt;">
        Sistem Absensi Karyawan Berbasis <em>Global Positioning System</em> dan Verifikasi <em>Selfie</em>
    </p>

    <div class="note">
        <strong>Informasi Aplikasi</strong>
        <p class="no-indent"><strong>Nama Aplikasi:</strong> E-Absensi</p>
        <p class="no-indent"><strong><em>Framework</em>:</strong> Laravel (PHP)</p>
        <p class="no-indent"><strong><em>Database</em>:</strong> MySQL</p>
        <p class="no-indent"><strong>Teknologi Utama:</strong> <em>GPS Location Tracking</em>, <em>Selfie Verification</em>, <em>Haversine Formula</em></p>
    </div>

    <h2>DAFTAR ISI</h2>
    <ol class="no-indent">
        <li>Ringkasan Aplikasi</li>
        <li>Sistem Autentikasi (<em>Login</em> dan <em>Register</em>)</li>
        <li>Menu <em>Sidebar</em> Admin</li>
        <li><em>Bottom Navigation</em> Pegawai</li>
        <li><em>Database</em> dan <em>Model</em></li>
        <li><em>Controllers</em> dan Fungsi-Fungsi</li>
        <li><em>Database Migrations</em></li>
        <li><em>Routes</em> (Pemetaan URL)</li>
    </ol>

    <div class="page-break"></div>

    <h1>BAB I<br/>RINGKASAN APLIKASI</h1>

    <p>Aplikasi E-Absensi merupakan sistem manajemen kehadiran karyawan yang menggunakan teknologi <em>Global Positioning System</em> (GPS) dan verifikasi <em>selfie</em>. Aplikasi ini dirancang untuk memastikan bahwa karyawan benar-benar berada di lokasi kantor pada saat melakukan absensi dengan cara memvalidasi jarak menggunakan radius yang telah ditentukan, serta menyimpan foto sebagai bukti kehadiran.</p>

    <h2>1.1 Fitur Utama Aplikasi</h2>

    <p>Aplikasi E-Absensi memiliki beberapa fitur utama sebagai berikut:</p>

    <ol>
        <li>Absensi masuk dan pulang dengan <em>GPS coordinates</em> dan foto <em>selfie</em></li>
        <li>Validasi radius lokasi kantor menggunakan <em>Haversine Formula</em></li>
        <li>Deteksi keterlambatan secara otomatis berdasarkan jam kerja</li>
        <li>Deteksi lembur otomatis berdasarkan waktu pulang</li>
        <li>Manajemen pengajuan izin, sakit, dan cuti karyawan</li>
        <li><em>Dashboard</em> admin untuk monitoring secara <em>real-time</em></li>
        <li>Laporan kehadiran lengkap dengan filter tanggal</li>
    </ol>

    <h2>1.2 Peran Pengguna dalam Sistem</h2>

    <p>Sistem memiliki dua peran pengguna utama yaitu Admin dan Pegawai dengan hak akses yang berbeda sebagaimana ditunjukkan pada Tabel 1.1.</p>

    <p class="table-title">Tabel 1.1 Peran Pengguna dalam Sistem</p>
    <table>
        <tr>
            <th width="20%">Peran</th>
            <th width="30%">Hak Akses</th>
            <th>Fitur</th>
        </tr>
        <tr>
            <td><strong>Admin</strong></td>
            <td>Akses penuh sistem</td>
            <td><em>Dashboard</em>, Manajemen Data Master, Manajemen Pegawai, Laporan Absensi, Persetujuan Izin dan Cuti</td>
        </tr>
        <tr>
            <td><strong>Pegawai</strong></td>
            <td>Akses data pribadi</td>
            <td>Absen Masuk/Pulang, Riwayat Absensi, Pengajuan Izin dan Cuti, Manajemen Profil</td>
        </tr>
    </table>

    <div class="page-break"></div>

    <h1>BAB II<br/>SISTEM AUTENTIKASI</h1>

    <h2>2.1 Autentikasi Admin</h2>

    <p class="no-indent"><strong>Berkas <em>Controller</em>:</strong> <code>app/Http/Controllers/AuthController.php</code></p>
    <p class="no-indent"><strong>Berkas <em>View</em>:</strong> <code>resources/views/auth/login/index.blade.php</code></p>
    <p class="no-indent"><strong>URL <em>Route</em>:</strong> <code>/login</code></p>

    <h3>2.1.1 Fungsi-Fungsi pada <em>AuthController</em></h3>

    <p><em>Controller</em> ini memiliki tiga fungsi utama untuk menangani autentikasi admin sebagaimana dijelaskan pada Tabel 2.1.</p>

    <p class="table-title">Tabel 2.1 Fungsi-Fungsi pada <em>AuthController</em></p>
    <table>
        <tr>
            <th width="30%">Fungsi</th>
            <th>Deskripsi</th>
        </tr>
        <tr>
            <td><code>index()</code></td>
            <td>Menampilkan halaman formulir <em>login</em> admin</td>
        </tr>
        <tr>
            <td><code>checklogin(Request $request)</code></td>
            <td>Memvalidasi kredensial admin (<em>email</em> dan <em>password</em>) serta membuat <em>session</em></td>
        </tr>
        <tr>
            <td><code>logout()</code></td>
            <td>Menghapus <em>session</em> dan melakukan <em>logout</em> admin</td>
        </tr>
    </table>

    <h3>2.1.2 Implementasi Fungsi <code>index()</code></h3>

    <p>Fungsi ini menampilkan halaman <em>login</em> admin. Implementasi kode program ditunjukkan pada Kode Program 2.1.</p>

    <p class="code-title">Kode Program 2.1 Fungsi <code>index()</code> pada <em>AuthController</em></p>
    <pre>
public function index()
{
    return view('auth.login.index');
}
    </pre>

    <h3>2.1.3 Implementasi Fungsi <code>checklogin()</code></h3>

    <p>Fungsi ini memvalidasi kredensial <em>login</em> admin dengan langkah-langkah sebagai berikut:</p>

    <ol>
        <li>Menerima inputan <em>email</em> dan <em>password</em> dari formulir</li>
        <li>Mencari pengguna di <em>database</em> berdasarkan <em>email</em> dan <em>role</em> yang bernilai 'Admin'</li>
        <li>Memeriksa kesesuaian <em>password</em> yang diinputkan dengan <em>password</em> di <em>database</em> menggunakan fungsi <code>Hash::check()</code></li>
        <li>Jika valid, menyimpan data pengguna ke dalam <em>session</em></li>
        <li>Melakukan <em>redirect</em> ke <em>dashboard</em> admin</li>
        <li>Jika tidak valid, melakukan <em>redirect</em> kembali ke halaman <em>login</em> dengan pesan kesalahan</li>
    </ol>

    <p>Implementasi fungsi <code>checklogin()</code> ditunjukkan pada Kode Program 2.2.</p>

    <p class="code-title">Kode Program 2.2 Fungsi <code>checklogin()</code> pada <em>AuthController</em></p>
    <pre>
public function checklogin(Request $request)
{
    // Validasi input
    $request->validate([
        'email' => 'required|email',
        'password' => 'required'
    ]);

    // Cari user berdasarkan email dan role Admin
    $user = User::where('email', $request->email)
                ->where('role', 'Admin')
                ->first();

    // Cek apakah user ditemukan dan password cocok
    if ($user && Hash::check($request->password, $user->password)) {
        // Simpan user ke session
        session(['user' => $user]);

        // Redirect ke dashboard admin
        return redirect('/main/dashboard')
               ->with('success', 'Login berhasil!');
    }

    // Jika gagal, redirect kembali dengan error
    return redirect()->back()
           ->with('error', 'Email atau password salah!');
}
    </pre>

    <h3>2.1.4 Implementasi Fungsi <code>logout()</code></h3>

    <p>Fungsi ini menghapus <em>session</em> pengguna dan melakukan <em>redirect</em> ke halaman <em>login</em>. Implementasi ditunjukkan pada Kode Program 2.3.</p>

    <p class="code-title">Kode Program 2.3 Fungsi <code>logout()</code> pada <em>AuthController</em></p>
    <pre>
public function logout()
{
    // Hapus session user
    session()->forget('user');

    // Redirect ke halaman login
    return redirect('/login')
           ->with('success', 'Logout berhasil!');
}
    </pre>

    <div class="page-break"></div>

    <h2>2.2 Autentikasi Pegawai</h2>

    <p class="no-indent"><strong>Berkas <em>Controller</em>:</strong> <code>app/Http/Controllers/HomeController.php</code></p>
    <p class="no-indent"><strong>Berkas <em>View</em>:</strong> <code>resources/views/pegawai/home/index.blade.php</code></p>
    <p class="no-indent"><strong>URL <em>Route</em>:</strong> <code>/</code> (<em>homepage</em>)</p>

    <h3>2.2.1 Fungsi-Fungsi <em>Login</em> pada <em>HomeController</em></h3>

    <p>Fungsi-fungsi autentikasi pegawai pada <em>HomeController</em> dijelaskan pada Tabel 2.2.</p>

    <p class="table-title">Tabel 2.2 Fungsi-Fungsi <em>Login</em> Pegawai</p>
    <table>
        <tr>
            <th width="30%">Fungsi</th>
            <th>Deskripsi</th>
        </tr>
        <tr>
            <td><code>index()</code></td>
            <td>Menampilkan halaman <em>landing page</em> atau formulir <em>login</em> pegawai</td>
        </tr>
        <tr>
            <td><code>checklogin(Request $request)</code></td>
            <td>Memvalidasi kredensial pegawai (NIK dan <em>password</em>) dengan <em>role</em> 'Pegawai'</td>
        </tr>
        <tr>
            <td><code>logout()</code></td>
            <td>Melakukan <em>logout</em> pegawai dan menghapus <em>session</em></td>
        </tr>
    </table>

    <h3>2.2.2 Implementasi Fungsi <code>checklogin()</code> untuk Pegawai</h3>

    <p>Berbeda dengan admin yang menggunakan <em>email</em> untuk <em>login</em>, pegawai menggunakan NIK (Nomor Induk Karyawan). Implementasi ditunjukkan pada Kode Program 2.4.</p>

    <p class="code-title">Kode Program 2.4 Fungsi <code>checklogin()</code> untuk Pegawai</p>
    <pre>
public function checklogin(Request $request)
{
    // Validasi input
    $request->validate([
        'nik' => 'required',
        'password' => 'required'
    ]);

    // Cari user berdasarkan NIK dan role Pegawai
    $user = User::where('nik', $request->nik)
                ->where('role', 'Pegawai')
                ->first();

    // Cek apakah user ditemukan dan password cocok
    if ($user && Hash::check($request->password, $user->password)) {
        // Simpan user ke session
        session(['user' => $user]);

        // Redirect ke dashboard pegawai
        return redirect('/pegawai/home')
               ->with('success', 'Login berhasil!');
    }

    // Jika gagal, redirect kembali dengan error
    return redirect()->back()
           ->with('error', 'NIK atau password salah!');
}
    </pre>

    <div class="note">
        <strong>Perbedaan Autentikasi Admin dan Pegawai</strong>
        <p><strong>Admin:</strong> Menggunakan <em>email</em> dan <em>password</em> untuk <em>login</em></p>
        <p><strong>Pegawai:</strong> Menggunakan NIK dan <em>password</em> untuk <em>login</em></p>
        <p>Kedua autentikasi divalidasi berdasarkan <em>field role</em> yang ada di tabel <code>users</code></p>
        <p><em>Session</em> disimpan dengan <em>key</em> yang sama yaitu <code>'user'</code></p>
    </div>

    <div class="page-break"></div>

    <h2>2.3 Registrasi Pegawai</h2>

    <p class="no-indent"><strong>Berkas <em>Controller</em>:</strong> <code>app/Http/Controllers/HomeController.php</code></p>
    <p class="no-indent"><strong>Berkas <em>View</em>:</strong> <code>resources/views/pegawai/register/index.blade.php</code></p>
    <p class="no-indent"><strong>URL <em>Route</em>:</strong> <code>/home/register</code></p>

    <h3>2.3.1 Fungsi-Fungsi Registrasi</h3>

    <p>Proses registrasi pegawai melibatkan dua fungsi utama yang dijelaskan pada Tabel 2.3.</p>

    <p class="table-title">Tabel 2.3 Fungsi-Fungsi Registrasi Pegawai</p>
    <table>
        <tr>
            <th width="30%">Fungsi</th>
            <th>Deskripsi</th>
        </tr>
        <tr>
            <td><code>register()</code></td>
            <td>Menampilkan formulir registrasi dengan <em>dropdown</em> Jabatan, Jam Kerja, dan Lokasi Penempatan</td>
        </tr>
        <tr>
            <td><code>saveregister(Request $request)</code></td>
            <td>Menyimpan data pegawai baru ke <em>database</em> dengan <em>role</em> 'Pegawai'</td>
        </tr>
    </table>

    <h3>2.3.2 Implementasi Fungsi <code>register()</code></h3>

    <p>Fungsi ini menampilkan formulir registrasi dengan <em>dropdown</em> yang diambil dari <em>database</em>. Implementasi ditunjukkan pada Kode Program 2.5.</p>

    <p class="code-title">Kode Program 2.5 Fungsi <code>register()</code></p>
    <pre>
public function register()
{
    // Ambil semua data jabatan dari database
    $jabatans = Jabatan::all();

    // Ambil semua data jam kerja dari database
    $jamKerjas = JamKerja::all();

    // Ambil semua data radius kantor dengan eager loading lokasi penempatan
    $radiusKantors = RadiusKantor::with('lokasiPenempatan')->get();

    // Kirim data ke view
    return view('pegawai.register.index',
                compact('jabatans', 'jamKerjas', 'radiusKantors'));
}
    </pre>

    <h3>2.3.3 Implementasi Fungsi <code>saveregister()</code></h3>

    <p>Fungsi ini memproses data registrasi pegawai baru dengan tahapan sebagai berikut:</p>

    <ol>
        <li>Validasi semua inputan yang diterima dari formulir</li>
        <li>Melakukan <em>hashing</em> terhadap <em>password</em> menggunakan algoritma <em>bcrypt</em> untuk keamanan</li>
        <li>Mengatur <em>role</em> secara otomatis menjadi 'Pegawai'</li>
        <li>Menyimpan data ke tabel <code>users</code></li>
        <li>Melakukan <em>redirect</em> ke halaman <em>login</em> dengan pesan sukses</li>
    </ol>

    <p>Implementasi lengkap ditunjukkan pada Kode Program 2.6.</p>

    <p class="code-title">Kode Program 2.6 Fungsi <code>saveregister()</code></p>
    <pre>
public function saveregister(Request $request)
{
    // Validasi input
    $request->validate([
        'nik' => 'required|unique:users,nik',
        'name' => 'required|string|max:255',
        'email' => 'required|email|unique:users,email',
        'password' => 'required|min:6',
        'jabatan_id' => 'required|exists:jabatans,id',
        'jam_kerja_id' => 'required|exists:jam_kerjas,id',
        'radius_kantor_id' => 'required|exists:radius_kantors,id'
    ]);

    // Buat user baru
    $user = new User();
    $user->nik = $request->nik;
    $user->name = $request->name;
    $user->email = $request->email;
    $user->password = bcrypt($request->password);
    $user->role = 'Pegawai';
    $user->jabatan_id = $request->jabatan_id;
    $user->jam_kerja_id = $request->jam_kerja_id;
    $user->radius_kantor_id = $request->radius_kantor_id;
    $user->save();

    // Redirect ke halaman login
    return redirect('/')
           ->with('success', 'Registrasi berhasil! Silakan login.');
}
    </pre>

    <h3>2.3.4 Data yang Wajib Diisi pada Registrasi</h3>

    <p>Tabel 2.4 menjelaskan <em>field</em>-<em>field</em> yang wajib diisi saat melakukan registrasi.</p>

    <p class="table-title">Tabel 2.4 <em>Field</em> yang Wajib Diisi pada Registrasi</p>
    <table>
        <tr>
            <th width="25%"><em>Field</em></th>
            <th width="15%">Tipe Data</th>
            <th>Keterangan</th>
        </tr>
        <tr>
            <td>NIK</td>
            <td>String</td>
            <td>Nomor Induk Karyawan (harus unik, tidak boleh duplikat)</td>
        </tr>
        <tr>
            <td>Nama</td>
            <td>String</td>
            <td>Nama lengkap pegawai (maksimal 255 karakter)</td>
        </tr>
        <tr>
            <td>Email</td>
            <td>String</td>
            <td>Alamat email aktif pegawai (harus unik dan format valid)</td>
        </tr>
        <tr>
            <td>Password</td>
            <td>String</td>
            <td>Kata sandi untuk <em>login</em> (minimal 6 karakter, akan di-<em>hash</em> dengan <em>bcrypt</em>)</td>
        </tr>
        <tr>
            <td>Jabatan</td>
            <td>Foreign Key</td>
            <td>Dipilih dari <em>dropdown</em> data master Jabatan (relasi ke tabel <code>jabatans</code>)</td>
        </tr>
        <tr>
            <td>Jam Kerja</td>
            <td>Foreign Key</td>
            <td>Dipilih dari <em>dropdown</em> data master Jam Kerja (relasi ke tabel <code>jam_kerjas</code>)</td>
        </tr>
        <tr>
            <td>Lokasi Penempatan</td>
            <td>Foreign Key</td>
            <td>Dipilih dari <em>dropdown</em> data master Radius Kantor (relasi ke tabel <code>radius_kantors</code>)</td>
        </tr>
    </table>

    <p class="center" style="margin-top: 24pt; font-weight: bold; font-size: 14pt;">
        --- AKHIR DOKUMENTASI ---
    </p>

    <div class="note" style="margin-top: 24pt;">
        <strong>Catatan:</strong>
        <p>Dokumentasi ini merupakan bagian dari dokumentasi lengkap aplikasi E-Absensi. Dokumentasi lengkap mencakup seluruh fitur aplikasi termasuk menu <em>sidebar</em> admin, <em>bottom navigation</em> pegawai, struktur <em>database</em>, implementasi <em>models</em>, <em>controllers</em>, <em>migrations</em>, dan <em>routing</em>.</p>
        <p><strong>Teknologi yang digunakan:</strong></p>
        <p style="text-indent: 0; margin-bottom: 3pt;"><em>Backend</em>: Laravel Framework (PHP)</p>
        <p style="text-indent: 0; margin-bottom: 3pt;"><em>Database</em>: MySQL dengan Eloquent ORM</p>
        <p style="text-indent: 0; margin-bottom: 3pt;"><em>Frontend</em>: Blade Template Engine, Bootstrap, jQuery</p>
        <p style="text-indent: 0; margin-bottom: 3pt;">GPS: HTML5 Geolocation API dengan <em>Haversine Formula</em></p>
        <p style="text-indent: 0; margin-bottom: 3pt;">Kamera: HTML5 getUserMedia API dengan <em>base64 encoding</em></p>
        <p style="text-indent: 0; margin-bottom: 3pt;">Autentikasi: <em>Session-based</em> dengan <em>bcrypt password hashing</em></p>
        <p style="text-indent: 0;"><em>Storage</em>: Laravel Storage (storage/app/public/images/)</p>
    </div>

</body>
</html>